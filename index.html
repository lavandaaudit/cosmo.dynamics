<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Живий Місяць • Фаза та Вид</title>
<style>
/* ================= RESET & BODY ================= */
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body {
  width: 100%;
  height: 100%;
  background: #000;
  color: #9fe7ff;
  font-family: "Courier New", monospace;
  overflow: hidden;
}
/* ================= STARS BACKGROUND ================= */
#starsCanvas {
  position: fixed;
  inset: 0;
  z-index: 0;
}
/* ================= MOON CANVAS ================= */
#moonCanvas {
  position: fixed;
  inset: 0;
  z-index: 1;
}
/* ================= WRAPPER (внизу) ================= */
.wrapper {
  position: fixed;
  bottom: 15px;
  left: 0;
  right: 0;
  z-index: 2;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  padding: 8px;
  pointer-events: none;
}
/* ================= БЛОК ДАНИХ МІСЯЦЯ ================= */
.moon-data {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  pointer-events: auto;
  text-align: center;
}
.moon-data .phase-bar {
  width: 260px;
  height: 4px;
  background: rgba(77,210,255,0.15);
  position: relative;
  margin: 4px 0;
}
.moon-data .phase-fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #9fe7ff, #4dd2ff);
  transition: width 0.8s ease;
  box-shadow: 0 0 8px rgba(77,210,255,0.4);
}
.moon-data .data-line {
  font-size: 11px;
  letter-spacing: 1.2px;
  opacity: 0.9;
}
.moon-data .combined-line {
  font-size: 11px;
  letter-spacing: 1.2px;
  opacity: 0.9;
}
/* ================= CONTROLS ================= */
.controls {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: 8px;
  pointer-events: auto;
}
button {
  background: transparent;
  border: 1px solid #4dd2ff;
  color: #4dd2ff;
  font-family: "Courier New", monospace;
  font-size: 12px;
  padding: 5px 10px;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.3s;
  pointer-events: auto;
}
button:hover {
  background: rgba(77,210,255,0.15);
  box-shadow: 0 0 10px rgba(77,210,255,0.6);
}
button.active {
  background: #4dd2ff;
  color: #000;
  box-shadow: 0 0 18px #4dd2ff;
}
/* ================= TEXT ================= */
.text-block {
  display: flex;
  flex-direction: column;
  gap: 4px;
  text-align: center;
  pointer-events: auto;
}
.main-text {
  font-size: 14px;
  letter-spacing: 1px;
}
.sub-text {
  font-size: 12px;
  letter-spacing: 1px;
  opacity: 0.8;
}
.footer-text {
  font-size: 10px;
  letter-spacing: 1px;
  opacity: 0.6;
}
.footer-text a {
  color: #4dd2ff;
  text-decoration: underline;
}
/* ================= MOBILE ================= */
@media (max-width: 600px) {
  button {
    font-size: 10px;
    padding: 4px 8px;
  }
  .main-text { font-size: 13px; }
  .sub-text { font-size: 11px; }
  .footer-text { font-size: 9px; }
  .wrapper { bottom: 8px; gap: 8px; }
  .moon-data .phase-bar { width: 200px; }
  .moon-data .data-line, .moon-data .combined-line {
    font-size: 10px;
  }
}
</style>
</head>
<body>
<canvas id="starsCanvas"></canvas>
<canvas id="moonCanvas"></canvas>
<div class="wrapper">
  <!-- Блок даних Місяця -->
  <div class="moon-data">
    <!-- Видалено заголовок "ФАЗА МІСЯЦЯ" -->
   
    <div>
      <div class="data-line" id="phase-text">—</div>
      <div class="phase-bar">
        <div class="phase-fill" id="phase-fill"></div>
      </div>
    </div>
   
    <!-- Параметри в одному рядку -->
    <div class="combined-line" id="combined-label">ОСВІТЛЕНІСТЬ: — % │ ВІК: — ДНІВ │ ВІДСТАНЬ: — КМ</div>
  </div>
  <!-- Кнопки масштабування -->
  <div class="controls">
    <button id="minusBtn">–</button>
    <button id="plusBtn">+</button>
  </div>
  <!-- Текстова інформація -->
  <div class="text-block">
    <div class="main-text" id="photoTime">завантаження...</div>
    <div class="sub-text">
      Ibonarium Cosmo Dynamics Lab LIVE — Center for Space & Planetary Monitoring
    </div>
    <div class="footer-text">
      <a href="https://t.me/ibonariumcosmodynamicslablive" target="_blank">
        https://t.me/ibonariumcosmodynamicslablive
      </a>
      <br>
      2026 ibonarium project by Roman Katyuschenko
    </div>
  </div>
</div>
<script>
/* ================= STARS BACKGROUND ================= */
const starsCanvas = document.getElementById("starsCanvas");
const sctx = starsCanvas.getContext("2d");
let W = starsCanvas.width = window.innerWidth;
let H = starsCanvas.height = window.innerHeight;
const stars = [];
const numStars = 300;
for (let i = 0; i < numStars; i++) {
  stars.push({
    x: Math.random() * W,
    y: Math.random() * H,
    size: Math.random() * 1.5 + 0.5,
    speed: Math.random() * 0.5 + 0.1,
    opacity: Math.random() * 0.8 + 0.2
  });
}
function drawStars() {
  sctx.clearRect(0, 0, W, H);
  sctx.fillStyle = "#fff";
  stars.forEach(star => {
    sctx.globalAlpha = star.opacity;
    sctx.fillRect(star.x, star.y, star.size, star.size);
    star.y += star.speed;
    if (star.y > H) star.y = 0;
  });
  sctx.globalAlpha = 1;
  requestAnimationFrame(drawStars);
}
drawStars();

/* ================= MOON CANVAS ================= */
const moonCanvas = document.getElementById('moonCanvas');
const ctx = moonCanvas.getContext('2d');
moonCanvas.width = W;
moonCanvas.height = H;
let scale = 0.25; // Ще менший стартовий розмір (було 0.3 → тепер 0.25)
let img = new Image();
const photoTimeEl = document.getElementById("photoTime");
const fallbackURL = "https://upload.wikimedia.org/wikipedia/commons/e/e1/FullMoon2010.jpg";

async function loadMoon() {
  const url = "https://theskylive.com/assets/moon/moon_phase.jpg?" + Date.now();
  
  return new Promise((resolve) => {
    img.onload = () => {
      const now = new Date();
      photoTimeEl.textContent = now.toISOString().replace("T", " ").split(".")[0] + " UTC";
      drawMoon();
      resolve();
    };
    img.onerror = () => {
      console.warn("Fallback до статичного зображення");
      photoTimeEl.textContent = "немає зв'язку (static)";
      img.src = fallbackURL;
      drawMoon();
      resolve();
    };
    img.src = url;
  });
}

function drawMoon() {
  ctx.clearRect(0, 0, W, H);
  if (img.complete && img.naturalWidth > 0) {
    const w = img.width * scale;
    const h = img.height * scale;
    const offsetY = H * -0.08;
    ctx.drawImage(img, (W - w) / 2, (H - h) / 2 + offsetY, w, h);
  }
}

/* ================= КЕРУВАННЯ МАСШТАБОМ ================= */
document.getElementById("minusBtn").addEventListener("click", () => {
  scale = Math.max(0.25, scale - 0.08); // Мінімум 0.25, менший крок для точності
  drawMoon();
});
document.getElementById("plusBtn").addEventListener("click", () => {
  scale = Math.min(2.5, scale + 0.08);
  drawMoon();
});
moonCanvas.addEventListener("wheel", e => {
  e.preventDefault();
  if (e.deltaY < 0) scale = Math.min(2.5, scale + 0.08);
  if (e.deltaY > 0) scale = Math.max(0.25, scale - 0.08);
  drawMoon();
});

/* ================= ДАНІ ФАЗИ МІСЯЦЯ ================= */
async function getMoonData() {
  try {
    const today = new Date().toISOString().slice(0,10);
    const response = await fetch(`https://api.usno.navy.mil/moon/phase?date=${today}`);
    const data = await response.json();
    if (data && data.phasedata && data.phasedata.length > 0) {
      const phaseData = data.phasedata[0];
      const illum = data.illum || 0;
      return {
        phase: phaseData.phase || "Невідома",
        illumination: illum,
        age: data.moonage || 0,
        distance: data.moondistance || 384400
      };
    }
  } catch (e) { console.error(e); }

  // Фолбек — математичний розрахунок
  const d = new Date();
  const year = d.getUTCFullYear();
  const month = d.getUTCMonth() + 1;
  const day = d.getUTCDate();
  let age = (year - 1900) * 12.3685 + (month - 1);
  age += day / 30.436875;
  age = (age - Math.floor(age)) * 29.53058867;
  const illumination = 50 * (1 - Math.cos(age * Math.PI / 14.765294335));
  let phaseName = "Новий Місяць";
  if (age > 1 && age < 13.5) phaseName = "Зростаючий Серп";
  else if (age < 16) phaseName = "Перша Чверть";
  else if (age < 28) phaseName = "Зростаючий Місяць";
  else if (age < 29.5) phaseName = "Повний Місяць";
  else phaseName = "Спадаючий Місяць";

  return {
    phase: phaseName,
    illumination: illumination,
    age: age,
    distance: 384400
  };
}

function updateMoonData(data) {
  const phaseText = document.getElementById('phase-text');
  const phaseFill = document.getElementById('phase-fill');
  const combinedLabel = document.getElementById('combined-label');

  if (!data) {
    phaseText.textContent = '—';
    phaseFill.style.width = '0%';
    combinedLabel.textContent = 'ОСВІТЛЕНІСТЬ: — % │ ВІК: — ДНІВ │ ВІДСТАНЬ: — КМ';
    return;
  }

  phaseText.textContent = data.phase.toUpperCase(); // Залишаємо тільки назву фази
  phaseFill.style.width = `${data.illumination}%`;
  combinedLabel.textContent = `ОСВІТЛЕНІСТЬ: ${data.illumination.toFixed(1)} % │ ВІК: ${data.age.toFixed(1)} ДНІВ │ ВІДСТАНЬ: ${Math.round(data.distance)} КМ`;
}

async function updateMoonPhaseData() {
  const data = await getMoonData();
  updateMoonData(data);
}

/* ================= АВТООНОВЛЕННЯ ================= */
setInterval(() => loadMoon(), 3600000);
setInterval(updateMoonPhaseData, 3600000);

/* ================= РЕСАЙЗ ================= */
window.addEventListener("resize", () => {
  W = starsCanvas.width = moonCanvas.width = window.innerWidth;
  H = starsCanvas.height = moonCanvas.height = window.innerHeight;
  drawMoon();
});

/* ================= СТАРТ ================= */
loadMoon();
updateMoonPhaseData();
</script>
</body>
</html>
