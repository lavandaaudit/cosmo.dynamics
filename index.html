<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Живий Місяць • Фаза та Вид</title>
<style>
/* ================= RESET & BODY ================= */
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body {
  width: 100%;
  height: 100%;
  background: #000;
  color: #9fe7ff;
  font-family: "Courier New", monospace;
  overflow: hidden;
}
/* ================= STARS BACKGROUND ================= */
#starsCanvas {
  position: fixed;
  inset: 0;
  z-index: 0;
}
/* ================= MOON CANVAS ================= */
#moonCanvas {
  position: fixed;
  inset: 0;
  z-index: 1;
}
/* ================= WRAPPER (внизу) ================= */
.wrapper {
  position: fixed;
  bottom: 15px;
  left: 0;
  right: 0;
  z-index: 2;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  padding: 8px;
  pointer-events: none;
}
/* ================= БЛОК ДАНИХ МІСЯЦЯ ================= */
.moon-data {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 6px;
  pointer-events: auto;
  text-align: center;
}
.moon-data .title {
  font-size: 12px;
  letter-spacing: 1.5px;
  opacity: 0.8;
}
.moon-data .phase-bar {
  width: 260px;
  height: 4px;
  background: rgba(77,210,255,0.15);
  position: relative;
  margin: 4px 0;
}
.moon-data .phase-fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, #9fe7ff, #4dd2ff);
  transition: width 0.8s ease;
  box-shadow: 0 0 8px rgba(77,210,255,0.4);
}
.moon-data .data-line {
  font-size: 11px;
  letter-spacing: 1.2px;
  opacity: 0.9;
}
/* ================= CONTROLS ================= */
.controls {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: 8px;
  pointer-events: auto;
}
button {
  background: transparent;
  border: 1px solid #4dd2ff;
  color: #4dd2ff;
  font-family: "Courier New", monospace;
  font-size: 12px;
  padding: 5px 10px;
  border-radius: 6px;
  cursor: pointer;
  transition: 0.3s;
  pointer-events: auto;
}
button:hover {
  background: rgba(77,210,255,0.15);
  box-shadow: 0 0 10px rgba(77,210,255,0.6);
}
button.active {
  background: #4dd2ff;
  color: #000;
  box-shadow: 0 0 18px #4dd2ff;
}
/* ================= TEXT ================= */
.text-block {
  display: flex;
  flex-direction: column;
  gap: 4px;
  text-align: center;
  pointer-events: auto;
}
.main-text {
  font-size: 14px;
  letter-spacing: 1px;
}
.sub-text {
  font-size: 12px;
  letter-spacing: 1px;
  opacity: 0.8;
}
.footer-text {
  font-size: 10px;
  letter-spacing: 1px;
  opacity: 0.6;
}
.footer-text a {
  color: #4dd2ff;
  text-decoration: underline;
}
/* ================= MOBILE ================= */
@media (max-width: 600px) {
  button {
    font-size: 10px;
    padding: 4px 8px;
  }
  .main-text { font-size: 13px; }
  .sub-text { font-size: 11px; }
  .footer-text { font-size: 9px; }
  .wrapper { bottom: 8px; gap: 8px; }
  .moon-data .phase-bar { width: 200px; }
  .moon-data .title, .moon-data .data-line {
    font-size: 10px;
  }
}
</style>
</head>
<body>
<canvas id="starsCanvas"></canvas>
<canvas id="moonCanvas"></canvas>
<div class="wrapper">
  <!-- Блок даних Місяця -->
  <div class="moon-data">
    <div class="title">ФАЗА МІСЯЦЯ</div>
   
    <div>
      <div class="data-line" id="phase-text">ФАЗА: —</div>
      <div class="phase-bar">
        <div class="phase-fill" id="phase-fill"></div>
      </div>
    </div>
   
    <div class="data-line" id="illumination-label">ОСВІТЛЕНІСТЬ: — %</div>
    <div class="data-line" id="age-label">ВІК: — ДНІВ</div>
    <div class="data-line" id="distance-label">ВІДСТАНЬ: — КМ</div>
  </div>
  <!-- Кнопки масштабування -->
  <div class="controls">
    <button id="minusBtn">–</button>
    <button id="plusBtn">+</button>
  </div>
  <!-- Текстова інформація -->
  <div class="text-block">
    <div class="main-text" id="photoTime">завантаження...</div>
    <div class="sub-text">
      Ibonarium Cosmo Dynamics Lab LIVE — Center for Space & Planetary Monitoring
    </div>
    <div class="footer-text">
      <a href="https://t.me/ibonariumcosmodynamicslablive" target="_blank">
        https://t.me/ibonariumcosmodynamicslablive
      </a>
      <br>
      2026 ibonarium project by Roman Katyuschenko
    </div>
  </div>
</div>
<script>
/* ================= STARS BACKGROUND ================= */
const starsCanvas = document.getElementById("starsCanvas");
const sctx = starsCanvas.getContext("2d");
let W = starsCanvas.width = window.innerWidth;
let H = starsCanvas.height = window.innerHeight;
const stars = [];
const numStars = 300;
for (let i = 0; i < numStars; i++) {
  stars.push({
    x: Math.random() * W,
    y: Math.random() * H,
    size: Math.random() * 1.5 + 0.5,
    speed: Math.random() * 0.5 + 0.1,
    opacity: Math.random() * 0.8 + 0.2
  });
}
function drawStars() {
  sctx.clearRect(0, 0, W, H);
  sctx.fillStyle = "#fff";
  stars.forEach(star => {
    sctx.globalAlpha = star.opacity;
    sctx.fillRect(star.x, star.y, star.size, star.size);
    star.y += star.speed;
    if (star.y > H) star.y = 0;
  });
  sctx.globalAlpha = 1;
  requestAnimationFrame(drawStars);
}
drawStars();

/* ================= MOON CANVAS ================= */
const moonCanvas = document.getElementById('moonCanvas');
const ctx = moonCanvas.getContext('2d');
moonCanvas.width = W;
moonCanvas.height = H;
let scale = 0.5; // Трохи більший стартовий масштаб для Місяця
let img = new Image();
const photoTimeEl = document.getElementById("photoTime");
const fallbackURL = "https://upload.wikimedia.org/wikipedia/commons/e/e1/FullMoon2010.jpg"; // Фолбек: повний Місяць

async function loadMoon() {
  // Використовуємо TheSkyLive для актуального вигляду фази Місяця (рендериться динамічно)
  const url = "https://theskylive.com/assets/moon/moon_phase.jpg?" + Date.now();
  
  return new Promise((resolve) => {
    img.onload = () => {
      const now = new Date();
      photoTimeEl.textContent = now.toISOString().replace("T", " ").split(".")[0] + " UTC";
      drawMoon();
      resolve();
    };
    img.onerror = () => {
      console.warn("Fallback до статичного зображення");
      photoTimeEl.textContent = "немає зв'язку (static)";
      img.src = fallbackURL;
      drawMoon();
      resolve();
    };
    img.src = url;
  });
}

function drawMoon() {
  ctx.clearRect(0, 0, W, H);
  if (img.complete && img.naturalWidth > 0) {
    const w = img.width * scale;
    const h = img.height * scale;
    const offsetY = H * -0.08;
    ctx.drawImage(img, (W - w) / 2, (H - h) / 2 + offsetY, w, h);
  }
}

/* ================= КЕРУВАННЯ МАСШТАБОМ ================= */
document.getElementById("minusBtn").addEventListener("click", () => {
  scale = Math.max(0.4, scale - 0.15);
  drawMoon();
});
document.getElementById("plusBtn").addEventListener("click", () => {
  scale = Math.min(2.5, scale + 0.15);
  drawMoon();
});
moonCanvas.addEventListener("wheel", e => {
  e.preventDefault();
  if (e.deltaY < 0) scale = Math.min(2.5, scale + 0.15);
  if (e.deltaY > 0) scale = Math.max(0.4, scale - 0.15);
  drawMoon();
});

/* ================= ДАНІ ФАЗИ МІСЯЦЯ ================= */
// Використовуємо безкоштовний API з https://api.astronomyapi.com (потрібна реєстрація для ключа, тут приклад)
// Альтернатива: простий розрахунок або статичний API. Тут використовуємо farmsense (якщо працює) або placeholder.
const MOON_API_URL = "https://api.farmsense.net/v1/moonphases/?d=" + Math.floor(Date.now() / 1000);

async function getMoonData() {
  try {
    const r = await fetch(MOON_API_URL);
    const d = await r.json();
    if (d && d.length > 0) {
      const data = d[0];
      return {
        phase: data.Phase || "Невідома",
        illumination: data.Illumination * 100 || 0,
        age: data.Age || 0,
        distance: data.Distance || 384400 // середня відстань як фолбек
      };
    }
  } catch (e) { console.error(e); }
  return null;
}

function updateMoonData(data) {
  const phaseText = document.getElementById('phase-text');
  const phaseFill = document.getElementById('phase-fill');
  const illumLabel = document.getElementById('illumination-label');
  const ageLabel = document.getElementById('age-label');
  const distLabel = document.getElementById('distance-label');

  if (!data) {
    phaseText.textContent = 'ФАЗА: —';
    phaseFill.style.width = '0%';
    illumLabel.textContent = 'ОСВІТЛЕНІСТЬ: — %';
    ageLabel.textContent = 'ВІК: — ДНІВ';
    distLabel.textContent = 'ВІДСТАНЬ: — КМ';
    return;
  }

  phaseText.textContent = `ФАЗА: ${data.phase.toUpperCase()}`;
  phaseFill.style.width = `${data.illumination}%`;
  illumLabel.textContent = `ОСВІТЛЕНІСТЬ: ${data.illumination.toFixed(1)} %`;
  ageLabel.textContent = `ВІК: ${data.age.toFixed(1)} ДНІВ`;
  distLabel.textContent = `ВІДСТАНЬ: ${Math.round(data.distance)} КМ`;
}

async function updateMoonPhaseData() {
  const data = await getMoonData();
  updateMoonData(data);
}

/* ================= АВТООНОВЛЕННЯ ================= */
setInterval(() => loadMoon(), 3600000); // Оновлення зображення щогодини (фаза змінюється повільно)
setInterval(updateMoonPhaseData, 3600000); // Дані щогодини

/* ================= РЕСАЙЗ ================= */
window.addEventListener("resize", () => {
  W = starsCanvas.width = moonCanvas.width = window.innerWidth;
  H = starsCanvas.height = moonCanvas.height = window.innerHeight;
  drawMoon();
});

/* ================= СТАРТ ================= */
loadMoon();
updateMoonPhaseData();
</script>
</body>
</html>
