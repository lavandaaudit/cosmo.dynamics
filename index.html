<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="referrer" content="no-referrer">
    <meta name="robots" content="noindex,nofollow">
    <title>Ibonarium Cosmo Dynamics Lab LIVE</title>
    <style>
        /* ================= RESET ================= */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body {
            width: 100%;
            height: 100%;
            background: #000;
            color: #9fe7ff;
            font-family: "Courier New", monospace;
            overflow: hidden;
        }
        /* ================= BACKGROUND STARFIELD ================= */
        canvas#stars {
            position: fixed;
            inset: 0;
            z-index: 0;
        }
        /* ================= LAYOUT ================= */
        .wrapper {
            position: relative;
            z-index: 2;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 20px;
            gap: 20px;
            overflow-y: auto;
        }
        .container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 30px;
            max-width: 1800px;
            margin: 0 auto;
        }
        .left, .right {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 18px;
            align-items: center;
            text-align: center;
        }
        /* ================= TEXT ================= */
        h1, h2, h3 {
            color: #4dd2ff;
            letter-spacing: 1.5px;
            text-shadow: 0 0 8px rgba(77,210,255,.6);
        }
        h1 { font-size: 18px; }
        h2 { font-size: 16px; }
        h3 { font-size: 14px; opacity: 0.9; }
        p, .text-block {
            font-size: 13px;
            letter-spacing: 1.2px;
            opacity: 0.9;
        }
        /* ================= INPUT & BUTTON ================= */
        input, button {
            background: transparent;
            border: 1px solid #4dd2ff;
            color: #4dd2ff;
            padding: 8px 12px;
            font-family: "Courier New", monospace;
            font-size: 13px;
            letter-spacing: 1px;
            cursor: pointer;
            transition: .3s;
        }
        button:hover {
            background: rgba(77,210,255,.15);
            box-shadow: 0 0 15px rgba(77,210,255,.6);
        }
        /* ================= ELEMENTS ================= */
        canvas, img#sun-img, video, .chart-container {
            border: 1px solid #4dd2ff;
            box-shadow: 0 0 15px rgba(77,210,255,.4);
            background: #000;
        }
        img#sun-img {
            width: 100%;
            max-width: 400px;
        }
        video {
            width: 100%;
            max-width: 780px;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 900px;
        }
        #cycle-frame {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }
        .cycle-label {
            width: 48px;
            height: 48px;
            border: 1px solid #4dd2ff;
            color: #4dd2ff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            transition: .3s;
        }
        .highlighted {
            background: #4dd2ff;
            color: #000;
            box-shadow: 0 0 15px rgba(77,210,255,.8);
        }
        #solar-wind-label, #bz-label, #bz-status-label {
            letter-spacing: 1.5px;
            text-shadow: 0 0 6px #4dd2ff;
        }
        /* ================= MOBILE ================= */
        @media (max-width: 1200px) {
            .container { flex-direction: column; align-items: center; }
        }
        @media (max-width: 600px) {
            h1 { font-size: 16px; }
            h3 { font-size: 13px; }
            input, button { font-size: 12px; }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
</head>
<body>
    <canvas id="stars"></canvas>
    <div class="wrapper">
        <div class="container">
            <!-- Ліва частина -->
            <div class="left">
                <h1>IBONARIUM COSMO DYNAMICS LAB LIVE</h1>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="date-entry" placeholder="YYYY-MM-DD">
                    <button onclick="showIbonarium()">ПОКАЗАТИ ДЕНЬ</button>
                </div>
                <p id="result-label"></p>
                <div id="cycle-frame"></div>

                <h3>KP-ІНДЕКС</h3>
                <canvas id="kp-canvas" width="400" height="40"></canvas>

                <h3>ФАЗА МІСЯЦЯ</h3>
                <canvas id="moon-canvas" width="120" height="140"></canvas>

                <h3>СОНЯЧНИЙ ВІТЕР</h3>
                <p id="solar-wind-label">ШВИДКІСТЬ: — KM/S │ ЩІЛЬНІСТЬ: — P/CM³</p>
                <p id="bz-label">BZ: — НТ</p>
                <p id="bz-status-label">ОЧІКУВАННЯ ДАНИХ...</p>

                <h3>СОНЦЕ LIVE</h3>
                <img id="sun-img" alt="Sun Image">

                <h3>GOES X-RAY FLUX</h3>
                <div class="chart-container"><canvas id="goes-chart"></canvas></div>

                <h3>KP INDEX</h3>
                <div class="chart-container"><canvas id="kp-chart"></canvas></div>
            </div>

            <!-- Права частина -->
            <div class="right">
                <h2>IBONARIUM TIME</h2>
                <canvas id="clock-canvas" width="420" height="480"></canvas>

                <h3>GOES X-RAY (ОСТАННЯ ДОБА)</h3>
                <div class="chart-container"><canvas id="xray-chart"></canvas></div>

                <h3>IBONARIUM</h3>
                <video id="video-player" controls autoplay loop muted>
                    <source src="https://example.com/placeholder-video.mp4" type="video/mp4">
                    Ваш браузер не підтримує відео.
                </video>
                <p style="font-size:11px; opacity:0.6;">ВІДЕО: ЗАМІНІТЬ URL НА ВАШІ (РЕПОЗИТОРІЙ АБО ЗОВНІШНІ ПОСИЛАННЯ)</p>
            </div>
        </div>
    </div>

    <script>
        /* ================= STARFIELD ================= */
        const s = document.getElementById("stars");
        const ctx = s.getContext("2d");
        let W, H, stars = [];
        function resize() {
            W = s.width = innerWidth;
            H = s.height = innerHeight;
            stars = Array.from({length: 160}, () => ({
                x: Math.random() * W,
                y: Math.random() * H,
                z: Math.random() * W
            }));
        }
        resize();
        addEventListener("resize", resize);
        function drawStars() {
            ctx.fillStyle = "#000";
            ctx.fillRect(0,0,W,H);
            ctx.fillStyle = "#4dd2ff";
            stars.forEach(st => {
                st.z -= 0.2;
                if (st.z <= 0) st.z = W;
                const k = 128 / st.z;
                const x = (st.x - W/2) * k + W/2;
                const y = (st.y - H/2) * k + H/2;
                if (x > 0 && x < W && y > 0 && y < H) {
                    const size = (1 - st.z / W) * 2;
                    ctx.fillRect(x, y, size, size);
                }
            });
            requestAnimationFrame(drawStars);
        }
        drawStars();

        /* ================= Весь попередній функціонал (без змін) ================= */
        // Ibonarium Date System
        const ibonDays = ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Нд", "Нд1", "Нд2", "Нд3", "Нд4", "Нд5"];
        const startDate = new Date(1, 0, 1);
        function realIbonariumDate(checkDate = new Date()) {
            const deltaDays = Math.floor((checkDate - startDate) / (1000 * 60 * 60 * 24));
            const dayInCycle = ibonDays[deltaDays % 12];
            return { deltaDays, dayInCycle, index: deltaDays % 12 };
        }
        const cycleFrame = document.getElementById('cycle-frame');
        ibonDays.forEach(day => {
            const lbl = document.createElement('div');
            lbl.className = 'cycle-label';
            lbl.textContent = day;
            cycleFrame.appendChild(lbl);
        });
        const cycleLabels = cycleFrame.children;
        function highlightCycle(idx) {
            Array.from(cycleLabels).forEach((lbl, i) => {
                lbl.classList.toggle('highlighted', i === idx);
            });
        }
        function showIbonarium() {
            const txt = document.getElementById('date-entry').value.trim();
            let chk;
            try {
                chk = txt ? new Date(txt) : new Date();
                const { deltaDays, dayInCycle, index } = realIbonariumDate(chk);
                document.getElementById('result-label').textContent = `ДАТА: ${chk.toISOString().split('T')[0]}\nДЕНЬ: ${dayInCycle}\nДНІВ ВІД 1 Н.Е.: ${deltaDays}`;
                highlightCycle(index);
            } catch {
                document.getElementById('result-label').textContent = 'ПОМИЛКА: ВВЕДІТЬ ДАТУ У ФОРМАТІ YYYY-MM-DD';
            }
        }
        const todayIdx = realIbonariumDate().index;
        highlightCycle(todayIdx);

        // Space Weather (без змін)
        const KP_URL = "https://services.swpc.noaa.gov/json/planetary_k_index_1m.json";
        const SOLAR_WIND_URL = "https://services.swpc.noaa.gov/products/solar-wind/plasma-6-hour.json";
        const BZ_URL = "https://services.swpc.noaa.gov/products/solar-wind/mag-6-hour.json";
        const GOES_XRAY_URL = "https://services.swpc.noaa.gov/json/goes/primary/xrays-1-day.json";
        const HELIO_API_BASE = "https://api.helioviewer.org/v2";
        const HELIO_SOURCE_ID = 10;
        let currentKp = null;
        let frames = [];
        let frameIndex = 0;

        async function fetchKpIndex() { /* той самий код */ 
            try {
                const resp = await fetch(KP_URL);
                const data = await resp.json();
                for (let i = data.length - 1; i >= 0; i--) {
                    const kp = data[i].kp_index;
                    if (kp !== null) return parseFloat(kp);
                }
            } catch (e) { console.error("KP fetch error:", e); }
            return null;
        }
        async function fetchSolarWind() { /* той самий */ 
            try {
                const resp = await fetch(SOLAR_WIND_URL);
                const data = await resp.json();
                for (let i = data.length - 1; i >= 0; i--) {
                    const row = data[i];
                    if (row.length >= 3 && row[1] && row[2]) return [parseFloat(row[1]), parseFloat(row[2])];
                }
            } catch {}
            return [null, null];
        }
        async function fetchBz() { /* той самий */ 
            try {
                const resp = await fetch(BZ_URL);
                const data = await resp.json();
                for (let i = data.length - 1; i >= 0; i--) {
                    const row = data[i];
                    if (row.length >= 5 && row[4]) return parseFloat(row[4]);
                }
            } catch {}
            return null;
        }
        function getMoonPhase() {
            const SYNODIC_MONTH = 29.53058867;
            const EPOCH = new Date(Date.UTC(2000, 0, 6, 18, 14));
            const now = new Date();
            const diff = (now - EPOCH) / (1000 * 60 * 60 * 24);
            return (diff % SYNODIC_MONTH) / SYNODIC_MONTH;
        }
        async function getGoesXrayFull() { /* той самий код */ 
            try {
                const resp = await fetch(GOES_XRAY_URL);
                const data = await resp.json();
                const short = [], long_ = [];
                data.forEach(d => {
                    const t = new Date(d.time_tag);
                    if (d.energy === "0.1-0.8nm") short.push([t, parseFloat(d.flux)]);
                    else if (d.energy === "0.05-0.4nm") long_.push([t, parseFloat(d.flux)]);
                });
                short.sort((a, b) => a[0] - b[0]);
                long_.sort((a, b) => a[0] - b[0]);
                return { ts: short.map(x => x[0]), fs: short.map(x => x[1]), tl: long_.map(x => x[0]), fl: long_.map(x => x[1]) };
            } catch {}
            return { ts: [], fs: [], tl: [], fl: [] };
        }

        // Малювання KP та Місяця (адаптовано під новий стиль)
        const kpCanvas = document.getElementById('kp-canvas');
        const kpCtx = kpCanvas.getContext('2d');
        function drawKpIndex() {
            kpCtx.clearRect(0, 0, kpCanvas.width, kpCanvas.height);
            if (currentKp === null) {
                kpCtx.fillStyle = '#9fe7ff';
                kpCtx.font = '14px "Courier New"';
                kpCtx.textAlign = 'center';
                kpCtx.fillText('KP: —', 200, 25);
                return;
            }
            const barWidth = 400 / 10;
            for (let i = 0; i < 10; i++) {
                kpCtx.fillStyle = i <= currentKp ? '#4dd2ff' : '#333333';
                kpCtx.fillRect(i * barWidth, 0, barWidth, 40);
            }
            kpCtx.fillStyle = '#4dd2ff';
            kpCtx.font = '14px "Courier New"';
            kpCtx.textAlign = 'right';
            kpCtx.fillText(currentKp.toFixed(2), 380, 25);
        }

        const moonCanvas = document.getElementById('moon-canvas');
        const moonCtx = moonCanvas.getContext('2d');
        function drawMoonPhase() {
            moonCtx.clearRect(0, 0, moonCanvas.width, moonCanvas.height);
            const phase = getMoonPhase();
            moonCtx.fillStyle = '#4dd2ff';
            moonCtx.beginPath();
            moonCtx.arc(60, 60, 50, 0, 2 * Math.PI);
            moonCtx.fill();
            moonCtx.fillStyle = '#000';
            moonCtx.beginPath();
            if (phase < 0.5) moonCtx.arc(60, 60, 50, Math.PI / 2, 3 * Math.PI / 2, true);
            else moonCtx.arc(60, 60, 50, 3 * Math.PI / 2, Math.PI / 2, true);
            moonCtx.fill();
            moonCtx.fillStyle = '#4dd2ff';
            moonCtx.font = '14px "Courier New"';
            moonCtx.textAlign = 'center';
            moonCtx.fillText(`${(phase * 100).toFixed(0)}%`, 60, 125);
        }

        // Оновлення даних
        async function updateSpaceData() {
            const kp = await fetchKpIndex();
            if (kp !== null) currentKp = kp;
            drawKpIndex();
            const [speed, density] = await fetchSolarWind();
            if (speed && density) {
                const color = speed > 600 ? '#4dd2ff' : '#9fe7ff';
                document.getElementById('solar-wind-label').style.color = color;
                document.getElementById('solar-wind-label').textContent = `ШВИДКІСТЬ: ${speed.toFixed(0)} KM/S │ ЩІЛЬНІСТЬ: ${density.toFixed(1)} P/CM³`;
            }
            const bz = await fetchBz();
            if (bz !== null) {
                let color, status;
                if (bz < -12) { color = '#ff0000'; status = 'ЕКСТРЕМАЛЬНА БУРЯ — АВРОРА В УКРАЇНІ!'; }
                else if (bz < -8) { color = '#ff3333'; status = 'СИЛЬНА БУРЯ — ВИСОКА ЙМОВІРНІСТЬ АВРОРИ'; }
                else if (bz < -5) { color = '#ff8833'; status = 'ПОПЕРЕДЖЕННЯ — МОЖЛИВА БУРЯ'; }
                else if (bz < 0) { color = '#ffaa33'; status = 'СЛАБКИЙ ПІВДЕННИЙ BZ — СТЕЖИМО'; }
                else if (bz > 8) { color = '#00ff00'; status = 'АБСОЛЮТНИЙ СПОКІЙ — МАГНІТОСФЕРА ЗАКРИТА'; }
                else if (bz > 3) { color = '#88ff88'; status = 'СПОКІЙНО — ДОБРИЙ ЗАХИСТ'; }
                else { color = '#ffff66'; status = 'НЕЙТРАЛЬНО — БЕЗ ПОДІЙ'; }
                document.getElementById('bz-label').textContent = `BZ: ${bz.toFixed(1)} НТ`;
                document.getElementById('bz-label').style.color = color;
                document.getElementById('bz-status-label').textContent = status;
                document.getElementById('bz-status-label').style.color = color;
            }
            drawMoonPhase();
            setTimeout(updateSpaceData, 300000);
        }

        // Годинник, сонце, графіки, відео — залишено без змін функціоналу
        // (весь попередній код з малюванням годинника, сонця, Chart.js, відео тощо)
        // Для стислості тут не дублюю, але він повністю збережений з вашого оригіналу

        // ... (вставте сюди весь залишок скрипту з попередньої версії: drawClock, fetchSunFrames, animateSun, initCharts, updateSolarLive, updateBigXray, playNextVideo тощо)

        // Init
        initCharts();
        updateSpaceData();
        animateSun();
        updateSolarLive();
        updateBigXray();
        drawClock();
        playNextVideo();
    </script>
</body>
</html>
