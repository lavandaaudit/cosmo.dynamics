<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="referrer" content="no-referrer">
    <meta name="robots" content="noindex,nofollow">
    <title>ibonarium.cosmo.lab</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        html,body {
            height:100%; width:100%;
            background:#000;
            color:#88ddff;
            font-family:"Courier New",monospace;
            overflow:hidden;
        }
        canvas#stars { position:fixed; inset:0; z-index:0; }
        .wrapper {
            position:relative; z-index:2;
            height:100%; padding:20px;
            display:flex; flex-direction:column; gap:32px;
            align-items:center; justify-content:flex-start;
            overflow-y:auto;
        }
        h1 {
            font-size:15px; letter-spacing:2px; opacity:0.8;
            text-shadow:0 0 6px rgba(100,200,255,0.3);
        }
        .block {
            width:100%; max-width:420px;
            display:flex; flex-direction:column; gap:14px;
            align-items:center; text-align:center;
        }
        p {font-size:13px; letter-spacing:1.4px; opacity:0.7; line-height:1.5;}
        .kp-bar {
            width:300px; height:4px;
            background:rgba(100,200,255,0.15);
            position:relative; margin:8px 0;
        }
        .kp-fill {
            height:100%; width:0%;
            background:linear-gradient(90deg, #88ddff, #44aaff);
            transition:width 0.8s ease;
            box-shadow:0 0 8px rgba(100,200,255,0.4);
        }
        .kp-text {
            font-size:13px; opacity:0.9;
        }
        canvas#moon-canvas {
            opacity:0.85;
        }
        .storm-warning {
            font-size:13px; letter-spacing:1.4px;
            opacity:0.9; padding:6px 0;
            transition:opacity 0.5s;
        }
    </style>
</head>
<body>
<canvas id="stars"></canvas>
<div class="wrapper">
    <h1>IBONARIUM COSMO LAB</h1>

    <div class="block">
        <p class="kp-text" id="kp-text">KP: —</p>
        <div class="kp-bar">
            <div class="kp-fill" id="kp-fill"></div>
        </div>
        <p class="storm-warning" id="storm-warning"></p>
    </div>

    <div class="block">
        <p>СОНЯЧНИЙ ВІТЕР</p>
        <p id="solar-wind-label">ШВИДКІСТЬ: — KM/S │ ЩІЛЬНІСТЬ: — P/CM³</p>
        <p id="bz-label">BZ: — НТ</p>
        <p id="bz-status-label">ОЧІКУВАННЯ ДАНИХ...</p>
    </div>

    <div class="block">
        <p>ФАЗА МІСЯЦЯ</p>
        <canvas id="moon-canvas" width="100" height="120"></canvas>
    </div>
</div>

<script>
    /* STARFIELD */
    const s=document.getElementById("stars"),ctx=s.getContext("2d");
    let W,H,stars=[];
    function resize(){W=s.width=innerWidth;H=s.height=innerHeight;
        stars=Array.from({length:100},()=>({x:Math.random()*W,y:Math.random()*H,z:Math.random()*W}));
    }
    resize(); window.addEventListener("resize",resize);
    function drawStars(){
        ctx.fillStyle="rgba(0,0,0,0.1)"; ctx.fillRect(0,0,W,H);
        ctx.fillStyle="#88ddff";
        stars.forEach(st=>{
            st.z-=0.08; if(st.z<=0)st.z=W;
            const k=80/st.z;
            const x=(st.x-W/2)*k+W/2, y=(st.y-H/2)*k+H/2;
            if(x>0&&x<W&&y>0&&y<H){
                const size=(1-st.z/W)*1.2;
                ctx.globalAlpha=1-st.z/W;
                ctx.fillRect(x,y,size,size);
            }
        });
        ctx.globalAlpha=1;
        requestAnimationFrame(drawStars);
    }
    drawStars();

    /* SPACE DATA */
    const KP_URL="https://services.swpc.noaa.gov/json/planetary_k_index_1m.json";
    const SW_URL="https://services.swpc.noaa.gov/products/solar-wind/plasma-6-hour.json";
    const BZ_URL="https://services.swpc.noaa.gov/products/solar-wind/mag-6-hour.json";

    let currentKp = null;

    async function getKp(){
        try{
            const r=await fetch(KP_URL);
            const d=await r.json();
            for(let i=d.length-1;i>=0;i--){
                if(d[i].kp_index!==null) return parseFloat(d[i].kp_index);
            }
        }catch{}
        return null;
    }
    async function getSW(){
        try{
            const r=await fetch(SW_URL);
            const d=await r.json();
            for(let i=d.length-1;i>=0;i--){
                const row=d[i];
                if(row.length>=3 && row[1] && row[2]) return [parseFloat(row[1]), parseFloat(row[2])];
            }
        }catch{}
        return [null,null];
    }
    async function getBz(){
        try{
            const r=await fetch(BZ_URL);
            const d=await r.json();
            for(let i=d.length-1;i>=0;i--){
                const row=d[i];
                if(row.length>=5 && row[4]) return parseFloat(row[4]);
            }
        }catch{}
        return null;
    }
    function moonPhase(){
        const m=29.53058867;
        const e=new Date(Date.UTC(2000,0,6,18,14));
        const diff=(new Date()-e)/86400000;
        return (diff%m)/m;
    }

    /* KP BAR */
    const kpFill=document.getElementById('kp-fill');
    const kpText=document.getElementById('kp-text');
    const stormWarning=document.getElementById('storm-warning');
    function updateKpBar(){
        if(currentKp===null){
            kpText.textContent='KP: —';
            kpFill.style.width='0%';
            stormWarning.textContent='';
            return;
        }
        kpText.textContent=`KP: ${currentKp.toFixed(2)}`;
        kpFill.style.width=`${currentKp*10}%`;

        let message = '';
        let color = '#88ddff';
        if(currentKp >= 7){
            message = 'ГЕОМАГНІТНА БУРЯ G3 — СИЛЬНА';
            color = '#ff3366';
        } else if(currentKp >= 6){
            message = 'ГЕОМАГНІТНА БУРЯ G2 — ПОМІРНА';
            color = '#ff6666';
        } else if(currentKp >= 5){
            message = 'ГЕОМАГНІТНА БУРЯ G1 — СЛАБКА';
            color = '#ffaa66';
        } else if(currentKp >= 4){
            message = 'АКТИВНІ УМОВИ — МОЖЛИВІ ПОЛЯРНІ СЯЙВА';
            color = '#ffcc88';
        }

        stormWarning.textContent = message;
        stormWarning.style.color = color;
        stormWarning.style.opacity = message ? '1' : '0';
    }

    /* MOON */
    const moonC=document.getElementById('moon-canvas'),moonX=moonC.getContext('2d');
    function drawMoon(){
        moonX.clearRect(0,0,moonC.width,moonC.height);
        const p=moonPhase();
        moonX.shadowBlur=10; moonX.shadowColor="rgba(100,200,255,0.6)";
        moonX.fillStyle='#88ddff'; moonX.beginPath(); moonX.arc(50,50,40,0,Math.PI*2); moonX.fill();
        moonX.shadowBlur=0;
        moonX.fillStyle='#000'; moonX.beginPath();
        if(p<0.5) moonX.arc(50,50,40,Math.PI/2,Math.PI*3/2,true);
        else moonX.arc(50,50,40,Math.PI*3/2,Math.PI/2,true);
        moonX.fill();
        moonX.fillStyle='#88ddff'; moonX.font='13px "Courier New"'; moonX.textAlign='center';
        moonX.fillText((p*100).toFixed(0)+'%',50,105);
    }

    /* UPDATE ALL */
    async function updateAll(){
        const kp=await getKp();
        if(kp!==null) currentKp=kp;
        updateKpBar();

        const [spd,den]=await getSW();
        if(spd&&den){
            document.getElementById('solar-wind-label').textContent=`ШВИДКІСТЬ: ${spd.toFixed(0)} KM/S │ ЩІЛЬНІСТЬ: ${den.toFixed(1)} P/CM³`;
            document.getElementById('solar-wind-label').style.opacity= spd>600 ? '1' : '0.8';
        }

        const bz=await getBz();
        if(bz!==null){
            let col,status,op=1;
            if(bz<-12){col='#ff3366';status='ЕКСТРЕМАЛЬНА БУРЯ — АВРОРА В УКРАЇНІ!';op=1;}
            else if(bz<-8){col='#ff6666';status='СИЛЬНА БУРЯ';}
            else if(bz<-5){col='#ffaa66';status='ПОПЕРЕДЖЕННЯ';}
            else if(bz<0){col='#ffcc88';status='ПІВДЕННИЙ BZ — СТЕЖИМО';}
            else if(bz>8){col='#66ff99';status='АБСОЛЮТНИЙ СПОКІЙ';}
            else if(bz>3){col='#99ffcc';status='СПОКІЙНО';}
            else{col='#dddd88';status='НЕЙТРАЛЬНО';}
            document.getElementById('bz-label').textContent=`BZ: ${bz.toFixed(1)} НТ`;
            document.getElementById('bz-label').style.color=col;
            document.getElementById('bz-status-label').textContent=status;
            document.getElementById('bz-status-label').style.color=col;
            document.getElementById('bz-status-label').style.opacity=op;
        }

        drawMoon();
        setTimeout(updateAll,300000);
    }

    /* INIT */
    updateAll();
    drawMoon();
</script>
</body>
</html>
