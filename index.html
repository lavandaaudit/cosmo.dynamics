<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="referrer" content="no-referrer">
    <meta name="robots" content="noindex,nofollow">
    <title>ibonarium.cosmo.lab</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        html,body {
            height:100%; width:100%;
            background:#000;
            color:#9fe7ff;
            font-family:"Courier New",monospace;
            overflow:hidden;
        }
        canvas#stars { position:fixed; inset:0; z-index:0; }
        .wrapper {
            position:relative; z-index:2;
            height:100%; padding:16px;
            display:flex; flex-direction:column; gap:20px;
            align-items:center; justify-content:flex-start;
            overflow-y:auto;
        }
        h1 {
            color:#4dd2ff; font-size:18px; letter-spacing:1.5px;
            text-shadow:0 0 8px rgba(77,210,255,.6);
        }
        .block {
            width:100%; max-width:460px;
            display:flex; flex-direction:column; gap:12px;
            align-items:center; text-align:center;
        }
        input,button{
            background:transparent; border:1px solid #4dd2ff;
            color:#4dd2ff; padding:8px 12px;
            font-size:14px; cursor:pointer;
            transition:.3s;
        }
        button:hover{background:rgba(77,210,255,.15);}
        p {font-size:14px; letter-spacing:1.2px; opacity:0.9;}
        #cycle-frame{
            display:flex; flex-wrap:wrap; justify-content:center; gap:8px;
        }
        .cycle-label{
            width:40px; height:40px;
            border:1px solid #4dd2ff; color:#4dd2ff;
            display:flex; align-items:center; justify-content:center;
            font-size:14px;
        }
        .highlighted{
            background:#4dd2ff; color:#000;
            box-shadow:0 0 12px rgba(77,210,255,.8);
        }
        .kp-bar {
            width:360px; height:40px;
            background:#222;
            border:1px solid #4dd2ff;
            position:relative;
            box-shadow:0 0 10px rgba(77,210,255,.4);
        }
        .kp-fill {
            height:100%; background:#4dd2ff;
            transition:width 0.5s;
        }
        .kp-text {
            position:absolute; top:0; left:0; width:100%; height:100%;
            display:flex; align-items:center; justify-content:center;
            color:#4dd2ff; font-size:14px;
        }
        canvas {border:1px solid #4dd2ff; box-shadow:0 0 10px rgba(77,210,255,.4); background:#000;}
    </style>
</head>
<body>
<canvas id="stars"></canvas>
<div class="wrapper">
    <h1>IBONARIUM COSMO LAB</h1>

    <div class="block">
        <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;">
            <input type="text" id="date-entry" placeholder="YYYY-MM-DD">
            <button onclick="showIbonarium()">ДЕНЬ</button>
        </div>
        <p id="result-label" style="white-space:pre-line;"></p>

        <div id="cycle-frame"></div>
    </div>

    <div class="block">
        <p>KP-ІНДЕКС</p>
        <div class="kp-bar">
            <div class="kp-fill" id="kp-fill" style="width:0%"></div>
            <div class="kp-text" id="kp-text">KP: —</div>
        </div>
    </div>

    <div class="block">
        <p>СОНЯЧНИЙ ВІТЕР</p>
        <p id="solar-wind-label">ШВИДКІСТЬ: — KM/S │ ЩІЛЬНІСТЬ: — P/CM³</p>
        <p id="bz-label">BZ: — НТ</p>
        <p id="bz-status-label">ОЧІКУВАННЯ ДАНИХ...</p>
    </div>

    <div class="block">
        <p>ФАЗА МІСЯЦЯ</p>
        <canvas id="moon-canvas" width="100" height="120"></canvas>
    </div>
</div>

<script>
    /* STARFIELD */
    const s=document.getElementById("stars"),ctx=s.getContext("2d");
    let W,H,stars=[];
    function resize(){W=s.width=innerWidth;H=s.height=innerHeight;
        stars=Array.from({length:120},()=>({x:Math.random()*W,y:Math.random()*H,z:Math.random()*W}));
    }
    resize(); window.addEventListener("resize",resize);
    function drawStars(){
        ctx.fillStyle="#000"; ctx.fillRect(0,0,W,H);
        ctx.fillStyle="#4dd2ff";
        stars.forEach(st=>{
            st.z-=0.15; if(st.z<=0)st.z=W;
            const k=100/st.z;
            const x=(st.x-W/2)*k+W/2, y=(st.y-H/2)*k+H/2;
            if(x>0&&x<W&&y>0&&y<H) ctx.fillRect(x,y,(1-st.z/W)*1.8,(1-st.z/W)*1.8);
        });
        requestAnimationFrame(drawStars);
    }
    drawStars();

    /* IBONARIUM DATE */
    const ibonDays=["Пн","Вт","Ср","Чт","Пт","Сб","Нд","Нд1","Нд2","Нд3","Нд4","Нд5"];
    const startDate=new Date(1,0,1);
    function realIbonariumDate(d=new Date()){
        const delta=Math.floor((d-startDate)/(86400000));
        return {delta,day:ibonDays[delta%12],idx:delta%12};
    }
    const cycleFrame=document.getElementById('cycle-frame');
    ibonDays.forEach(day=>{
        const el=document.createElement('div');
        el.className='cycle-label'; el.textContent=day;
        cycleFrame.appendChild(el);
    });
    function highlight(idx){
        Array.from(cycleFrame.children).forEach((e,i)=>e.classList.toggle('highlighted',i===idx));
    }
    function showIbonarium(){
        const val=document.getElementById('date-entry').value.trim();
        const d=val?new Date(val):new Date();
        if(isNaN(d)){document.getElementById('result-label').textContent='ПОМИЛКА ФОРМАТУ'; return;}
        const {delta,day,idx}=realIbonariumDate(d);
        document.getElementById('result-label').textContent=`ДАТА: ${d.toISOString().slice(0,10)}\nДЕНЬ: ${day}\nДНІВ ВІД 1 Н.Е.: ${delta}`;
        highlight(idx);
    }
    highlight(realIbonariumDate().idx);

    /* SPACE DATA */
    const KP_URL="https://services.swpc.noaa.gov/json/planetary_k_index_1m.json";
    const SW_URL="https://services.swpc.noaa.gov/products/solar-wind/plasma-6-hour.json";
    const BZ_URL="https://services.swpc.noaa.gov/products/solar-wind/mag-6-hour.json";

    let currentKp = null;

    async function getKp(){
        try{
            const r=await fetch(KP_URL);
            const d=await r.json();
            for(let i=d.length-1;i>=0;i--){
                if(d[i].kp_index!==null) return parseFloat(d[i].kp_index);
            }
        }catch(e){console.error(e);}
        return null;
    }
    async function getSW(){
        try{
            const r=await fetch(SW_URL);
            const d=await r.json();
            for(let i=d.length-1;i>=0;i--){
                const row=d[i];
                if(row.length>=3 && row[1] && row[2]) return [parseFloat(row[1]), parseFloat(row[2])];
            }
        }catch{}
        return [null,null];
    }
    async function getBz(){
        try{
            const r=await fetch(BZ_URL);
            const d=await r.json();
            for(let i=d.length-1;i>=0;i--){
                const row=d[i];
                if(row.length>=5 && row[4]) return parseFloat(row[4]);
            }
        }catch{}
        return null;
    }
    function moonPhase(){
        const m=29.53058867;
        const e=new Date(Date.UTC(2000,0,6,18,14));
        const diff=(new Date()-e)/86400000;
        return (diff%m)/m;
    }

    /* KP BAR */
    const kpFill=document.getElementById('kp-fill');
    const kpText=document.getElementById('kp-text');
    function updateKpBar(){
        if(currentKp===null){
            kpText.textContent='KP: —';
            kpFill.style.width='0%';
        }else{
            kpText.textContent=`KP: ${currentKp.toFixed(2)}`;
            kpFill.style.width=`${currentKp*10}%`;
        }
    }

    /* MOON */
    const moonC=document.getElementById('moon-canvas'),moonX=moonC.getContext('2d');
    function drawMoon(){
        moonX.clearRect(0,0,moonC.width,moonC.height);
        const p=moonPhase();
        moonX.fillStyle='#4dd2ff'; moonX.beginPath(); moonX.arc(50,50,40,0,Math.PI*2); moonX.fill();
        moonX.fillStyle='#000'; moonX.beginPath();
        if(p<0.5) moonX.arc(50,50,40,Math.PI/2,Math.PI*3/2,true);
        else moonX.arc(50,50,40,Math.PI*3/2,Math.PI/2,true);
        moonX.fill();
        moonX.fillStyle='#4dd2ff'; moonX.font='14px "Courier New"'; moonX.textAlign='center';
        moonX.fillText((p*100).toFixed(0)+'%',50,105);
    }

    /* UPDATE ALL */
    async function updateAll(){
        const kp=await getKp();
        if(kp!==null) currentKp=kp;
        updateKpBar();

        const [spd,den]=await getSW();
        if(spd&&den){
            document.getElementById('solar-wind-label').textContent=`ШВИДКІСТЬ: ${spd.toFixed(0)} KM/S │ ЩІЛЬНІСТЬ: ${den.toFixed(1)} P/CM³`;
            document.getElementById('solar-wind-label').style.color=spd>600?'#4dd2ff':'#9fe7ff';
        }

        const bz=await getBz();
        if(bz!==null){
            let col,status;
            if(bz<-12){col='#ff0000';status='ЕКСТРЕМАЛЬНА БУРЯ — АВРОРА В УКРАЇНІ!';}
            else if(bz<-8){col='#ff3333';status='СИЛЬНА БУРЯ';}
            else if(bz<-5){col='#ff8833';status='ПОПЕРЕДЖЕННЯ';}
            else if(bz<0){col='#ffaa33';status='ПІВДЕННИЙ BZ — СТЕЖИМО';}
            else if(bz>8){col='#00ff00';status='АБСОЛЮТНИЙ СПОКІЙ';}
            else if(bz>3){col='#88ff88';status='СПОКІЙНО';}
            else{col='#ffff66';status='НЕЙТРАЛЬНО';}
            document.getElementById('bz-label').textContent=`BZ: ${bz.toFixed(1)} НТ`;
            document.getElementById('bz-label').style.color=col;
            document.getElementById('bz-status-label').textContent=status;
            document.getElementById('bz-status-label').style.color=col;
        }

        drawMoon();
        setTimeout(updateAll,300000); // 5 хвилин
    }

    /* INIT */
    updateAll();
    drawMoon();
</script>
</body>
</html>
